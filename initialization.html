

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="">
    
    
      
        <title>Boot and Initialization - I3C Core - documentation</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="_static/sphinx_immaterial_theme.4b4a8c74e2ff2ab5b.min.css?v=afa97f93" />
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="I3C Core - documentation" class="md-header__button md-logo" aria-label="I3C Core - documentation" data-md-component="logo">
      <img src="_static/white.svg" alt="logo">
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            I3C Core - documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Boot and Initialization
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <div class="md-header__button">
        <a href="i3c-core--documentation.pdf" title="PDF - i3c-core--documentation.pdf">
          <div class="md-icon">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M64 0C28.7 0 0 28.7 0 64v384c0 35.3 28.7 64 64 64h256c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zm192 0v128h128L256 0zM64 224h24c30.9 0 56 25.1 56 56s-25.1 56-56 56h-8v32c0 8.8-7.2 16-16 16s-16-7.2-16-16V240c0-8.8 7.2-16 16-16zm24 80c13.3 0 24-10.7 24-24s-10.7-24-24-24h-8v48h8zm72-64c0-8.8 7.2-16 16-16h24c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48h-24c-8.8 0-16-7.2-16-16V240zm32 112h8c8.8 0 16-7.2 16-16v-64c0-8.8-7.2-16-16-16h-8v96zm96-128h48c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v32h32c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v48c0 8.8-7.2 16-16 16s-16-7.2-16-16V240c0-8.8 7.2-16 16-16z"/></svg>
          </div>
        </a>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="I3C Core - documentation" class="md-nav__button md-logo" aria-label="I3C Core - documentation" data-md-component="logo">
      <img src="_static/white.svg" alt="logo">
    </a>
    I3C Core - documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        <span class="md-ellipsis">Introduction</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2">
          <span class="md-ellipsis">Hardware Design and Verification</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hardware Design and Verification" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Hardware Design and Verification</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="top.html" class="md-nav__link">
        <span class="md-ellipsis">Overview</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="controller_interfaces.html" class="md-nav__link">
        <span class="md-ellipsis">Controller Interfaces</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="controller_standby.html" class="md-nav__link">
        <span class="md-ellipsis">Standby Controller</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="controller_phy.html" class="md-nav__link">
        <span class="md-ellipsis">Physical Layer</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="dv.html" class="md-nav__link">
        <span class="md-ellipsis">Design verification</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="ci_queues.html" class="md-nav__link">
        <span class="md-ellipsis">Controller Interface Queues</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="timings.html" class="md-nav__link">
        <span class="md-ellipsis">Electrical and timing specifications</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3">
          <span class="md-ellipsis">Programmer&#39;s Reference Manual</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Programmer&#39;s Reference Manual" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Programmer&#39;s Reference Manual</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span class="md-ellipsis">Boot and Initialization</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span class="md-ellipsis">Boot and Initialization</span>
      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#boot" class="md-nav__link">
    <span class="md-ellipsis">Boot</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#primary-controller-initialization" class="md-nav__link">
    <span class="md-ellipsis">Primary Controller Initialization</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secondary-controller-initialization" class="md-nav__link">
    <span class="md-ellipsis">Secondary Controller Initialization</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#minimal-configuration" class="md-nav__link">
    <span class="md-ellipsis">Minimal configuration</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="normal_operation.html" class="md-nav__link">
        <span class="md-ellipsis">Normal operation</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4">
          <span class="md-ellipsis">Extended Capabilities and Recovery Flow</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Extended Capabilities and Recovery Flow" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Extended Capabilities and Recovery Flow</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="ext_cap.html" class="md-nav__link">
        <span class="md-ellipsis">Specification for I3C Vendor-<wbr>Specific Extended Capabilities</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="recovery_flow.html" class="md-nav__link">
        <span class="md-ellipsis">Recovery flow</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5">
          <span class="md-ellipsis">Integrating the I3C Core</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Integrating the I3C Core" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Integrating the I3C Core</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="config.html" class="md-nav__link">
        <span class="md-ellipsis">Configuring the I3C Core</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="integration.html" class="md-nav__link">
        <span class="md-ellipsis">Integration with Caliptra Subsystem</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="testing.html" class="md-nav__link">
        <span class="md-ellipsis">FPGA Validation Platform</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


<h1 id="boot-and-initialization">Boot and Initialization<a class="headerlink" href="#boot-and-initialization" title="Link to this heading">¶</a></h1>
<h2 id="boot">Boot<a class="headerlink" href="#boot" title="Link to this heading">¶</a></h2>
<p>After Power-On Reset, the core should be configured to prevent it from interacting with the I3C bus in any way.</p>
<p>This implementation supports 3 modes at boot:</p>
<ul class="simple">
<li><p>Active Controller Mode</p></li>
<li><p>Secondary Controller Mode (Target)</p></li>
<li><p>Disabled Mode</p></li>
</ul>
<p>We propose the following boot sequence:</p>
<ul class="simple">
<li><p>Power-On Reset</p></li>
<li><p>Device is in Disabled Mode (reset values defined at synthesis time)</p></li>
<li><p>System Manager initializes itself and enables clock for the I3C Core</p></li>
<li><p>System Manager initializes relevant registers of the I3C Core</p></li>
<li><p>System Manager enables the desired mode of operation: Active or Secondary Controller Mode</p></li>
<li><p>The device is ready for normal operation</p></li>
</ul>
<h2 id="primary-controller-initialization">Primary Controller Initialization<a class="headerlink" href="#primary-controller-initialization" title="Link to this heading">¶</a></h2>
<p>The following section details the initialization process on the software driver side, in compliance with the <a class="reference internal" href="introduction.html#spec-i3c-hci"><span class="std std-ref">I3C HCI Specification</span></a>:</p>
<ul class="simple">
<li><p>“6.1.1 Host Controller Initialization” in the PIO mode</p></li>
<li><p>“6.17.1.1 Secondary Controller Initialization”</p></li>
</ul>
<p>The following process is described under the assumption that the controller has undergone software- or hardware-issued reset prior to the initialization, so that all the registers and internal FSMs are in the default state.</p>
<p>To initialize the controller, the software is expected to perform the following steps:</p>
<ol class="arabic simple">
<li><p>Verify the value of the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#hci_version-register">HCI_VERSION</a> register at the <code class="docutils literal notranslate"><span class="pre">I3CBase</span></code> address.
The controller is compliant with MIPI HCI v1.2 and therefore the <code class="docutils literal notranslate"><span class="pre">HCI_VERSION</span></code> should read <code class="docutils literal notranslate"><span class="pre">0x120</span></code></p></li>
<li><p>Evaluate DAT &amp; DCT table offsets:</p>
<ul class="simple">
<li><p>The <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#dat_section_offset-register">DAT_SECTION_OFFSET</a> register defined at <code class="docutils literal notranslate"><span class="pre">I3CBase</span> <span class="pre">+</span> <span class="pre">0x30</span></code></p></li>
<li><p>The <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#dct_section_offset-register">DCT_SECTION_OFFSET</a> register defined at <code class="docutils literal notranslate"><span class="pre">I3CBase</span> <span class="pre">+</span> <span class="pre">0x34</span></code></p></li>
<li><p>Both <code class="docutils literal notranslate"><span class="pre">DAT_SECTION_OFFSET</span></code> and <code class="docutils literal notranslate"><span class="pre">DCT_SECTION_OFFSET</span></code> contain the corresponding table offset, number of entries &amp; table size</p></li>
<li><p>HCI spec permits to require the driver to allocate the DAT &amp; DCT table, in which case the <code class="docutils literal notranslate"><span class="pre">TABLE_OFFSET</span></code> would read 0. This specific controller implementation allocates both DAT and DCT tables in the registers</p></li>
</ul>
</li>
<li><p>Evaluate <code class="docutils literal notranslate"><span class="pre">PIO_SECTION_OFFSET</span></code>:</p>
<ul class="simple">
<li><p>Read <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#pio_section_offset-register">PIO_SECTION_OFFSET</a> at <code class="docutils literal notranslate"><span class="pre">I3CBase</span>&#160; <span class="pre">+</span> <span class="pre">0x3c</span></code>, the <code class="docutils literal notranslate"><span class="pre">section_offset</span></code> field points to the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#piocontrol-register-file">PIOControl register file</a> that contains command, transfer, response and IBI ports as well as PIO control registers</p></li>
<li><p>This specific controller implements the PIO mode capability. If it’s not supported, <code class="docutils literal notranslate"><span class="pre">SECTION_OFFSET</span></code> will read 0</p></li>
</ul>
</li>
<li><p>Evaluate <code class="docutils literal notranslate"><span class="pre">RING_HEADERS_SECTION_OFFSET</span></code>, the <code class="docutils literal notranslate"><span class="pre">SECTION_OFFSET</span></code> should read <code class="docutils literal notranslate"><span class="pre">0x0</span></code> as this controller doesn’t support the DMA mode</p></li>
<li><p>Evaluate the <code class="docutils literal notranslate"><span class="pre">HC_CAPABILITIES</span></code> register at <code class="docutils literal notranslate"><span class="pre">I3CBase</span> <span class="pre">+</span> <span class="pre">0xC</span></code>:</p>
<ul class="simple">
<li><p>It stores controller capabilities such as scatter-gather, scheduled commands, combo transfers, IBI data abort, command size</p></li>
</ul>
</li>
<li><p>Extended capabilities evaluation via <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#ext_caps_section_offset-register">EXT_CAPS_SECTION_OFFSET</a> at <code class="docutils literal notranslate"><span class="pre">I3CBase</span> <span class="pre">+</span> <span class="pre">0x40</span></code></p>
<ul class="simple">
<li><p>Evaluate the linked list of Extended Capability structures, until the end of the linked list (i.e., an instance of the <code class="docutils literal notranslate"><span class="pre">EXTCAP_HEADER</span></code> register with the <code class="docutils literal notranslate"><span class="pre">0x00</span></code> value in the <code class="docutils literal notranslate"><span class="pre">CAP_ID</span></code> field)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXT_OFFSET</span></code> will read <code class="docutils literal notranslate"><span class="pre">0x0</span></code> if the extended capabilities are not supported</p></li>
</ul>
</li>
<li><p>Setup the threshold for the HCI queues (in the internal/private software data structures):</p>
<ul class="simple">
<li><p>The command, data buffer and IBI status queue sizes can be obtained through the <code class="docutils literal notranslate"><span class="pre">QUEUE_SIZE</span></code> register at <code class="docutils literal notranslate"><span class="pre">PIO_OFFSET</span> <span class="pre">+</span> <span class="pre">0x18</span></code></p></li>
<li><p>The response queue size is defined at <code class="docutils literal notranslate"><span class="pre">ALT_QUEUE_SIZE</span></code> at <code class="docutils literal notranslate"><span class="pre">PIO_OFFSET</span> <span class="pre">+</span> <span class="pre">0x1C</span></code> when the size of the command queue is not equal to the size of the response queue (which is the case for this host controller)</p></li>
<li><p>both are contained within <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#piocontrol-register-file">PIOControl register file</a></p></li>
</ul>
</li>
<li><p>Enable the host controller:</p>
<ul class="simple">
<li><p>Ensure the <code class="docutils literal notranslate"><span class="pre">MODE_SELECTOR</span></code> field in the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#hc_control-register">HC_CONTROL</a> register is set to <code class="docutils literal notranslate"><span class="pre">0x1</span></code> (PIO mode)</p></li>
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">BUS_ENABLE</span></code> field in the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#hc_control-register">HC_CONTROL</a> register</p></li>
</ul>
</li>
<li><p>Enable controller interrupts:</p>
<ul class="simple">
<li><p>Set fields for the status interrupts to be enabled in the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#intr_status_enable-register">INTR_STATUS_ENABLE</a> register at <code class="docutils literal notranslate"><span class="pre">I3CBase</span> <span class="pre">+</span> <span class="pre">0x24</span></code>; the following status interrupts can be set:</p>
<ul>
<li><p>Scheduled command missed tick</p></li>
<li><p>Controller command sequence stall / timeout</p></li>
<li><p>Controller canceled transaction sequence</p></li>
<li><p>Controller internal error</p></li>
</ul>
</li>
<li><p>Upon writing <code class="docutils literal notranslate"><span class="pre">1'b1</span></code>, the interrupt will be reported in <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#intr_status-register">STATUS_REGISTER</a></p></li>
<li><p>Setting the fields in the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#intr_signal_enable-register">INTR_SIGNAL_ENABLE</a> register at <code class="docutils literal notranslate"><span class="pre">I3CBase</span> <span class="pre">+</span> <span class="pre">0x28</span></code> will result in not only reporting the interrupt in the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#intr_status-register">STATUS_REGISTER</a> register but will also deliver an interrupt condition to the host (interrupt trigger)</p></li>
</ul>
</li>
<li><p>Enable and start PIO queues:</p>
<ul class="simple">
<li><p>Enable PIO interrupts via <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#pio_intr_status_enable-register">PIO_INTR_STATUS_ENABLE</a> at <code class="docutils literal notranslate"><span class="pre">PIO_OFFSET</span> <span class="pre">+</span> <span class="pre">0x20</span></code> and <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#pio_intr_signal_enable-register">PIO_INTR_SIGNAL_ENABLE</a> at <code class="docutils literal notranslate"><span class="pre">PIO_OFFSET</span> <span class="pre">+</span> <span class="pre">0x20</span></code>; enabling fields in the status register will cause the interrupts to be reported via the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#pio_intr_status-register">PIO_INTR_STATUS</a> register, additionally enabling interrupts in <code class="docutils literal notranslate"><span class="pre">PIO_INTR_SIGNAL_ENABLE</span></code> will cause an event for the host controller</p></li>
<li><p>Enable queues by setting the <code class="docutils literal notranslate"><span class="pre">ENABLE</span></code> field in the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#pio_control-register">PIO_CONTROL</a> register</p></li>
<li><p>Start PIO queues by setting the <code class="docutils literal notranslate"><span class="pre">RS</span></code> field in the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#pio_control-register">PIO_CONTROL</a> register</p></li>
</ul>
</li>
</ol>
<p>The host control will expose its register map and will await the driver to set the <code class="docutils literal notranslate"><span class="pre">BUS_ENABLE</span></code> bit in the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#hc_control-register">HC_CONTROL</a> register.
After that, the controller will evaluate the capabilities limited by the software and initialize internal queues &amp; resources accordingly.</p>
<h2 id="secondary-controller-initialization">Secondary Controller Initialization<a class="headerlink" href="#secondary-controller-initialization" title="Link to this heading">¶</a></h2>
<p>The Secondary Controller Initialization process requires additional steps (in addition to the previous steps):</p>
<ol class="arabic simple">
<li><p>Evaluate the Standby Controller Mode Extended Capability structure (see Section 7.7.11):</p>
<ul class="simple">
<li><p>Determine whether an I3C Target Transaction Interface to software is supported.</p>
<ul>
<li><p>If this interface is supported, then discover its capabilities and configure the interface appropriately (i.e., by using its vendor-specified Extended Capability structure). Then, enable the interface using the <code class="docutils literal notranslate"><span class="pre">TARGET_XACT_ENABLE</span></code> field in the <code class="docutils literal notranslate"><span class="pre">STBY_CR_CONTROL</span></code> register (Section 7.7.11.1).</p></li>
</ul>
</li>
<li><p>Determine which methods of Dynamic Address Assignment are implemented and supported by reading the <code class="docutils literal notranslate"><span class="pre">STBY_CR_CAPABILITIES</span></code> register (Section 7.7.11.3)</p></li>
<li><p>Determine which other CCCs need to be supported and configured, either as registers in the Standby Controller Mode Extended Capability structure, or as registers in any instances of other vendor-specific Extended Capability structures that might be defined to provide control for such CCC handling.</p></li>
</ul>
</li>
<li><p>Set the BCR bits and the DCR value in the <code class="docutils literal notranslate"><span class="pre">STBY_CR_DEVICE_CHAR</span></code> register (Section 7.7.11.5).</p></li>
<li><p>Optionally, set the PID value in the <code class="docutils literal notranslate"><span class="pre">STBY_CR_DEVICE_CHAR</span></code> and <code class="docutils literal notranslate"><span class="pre">STBY_CR_DEVICE_PID_LO</span></code> registers (Section 7.7.11.5 and Section 7.7.11.6) if required for the Dynamic Address Assignment with the ENTDAA procedure, or if it is known that the GETPID CCC will be used by an Active Controller.</p></li>
<li><p>Configure registers to set up autonomous responses for CCCs, for those CCCs that are defined for such handling in this specification (see Section 6.17.3.1).</p></li>
<li><p>Enable Secondary Controller Interrupts:</p>
<ul class="simple">
<li><p>In the <code class="docutils literal notranslate"><span class="pre">STBY_CR_INTR_SIGNAL_ENABLE</span></code> register (Section 7.7.11.8), set the mask of enabled interrupts.</p></li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The specification states that the order of these operations has to be adjusted based on the initial desired operation, as well as supported handoff procedures.</p>
</div>
<h2 id="minimal-configuration">Minimal configuration<a class="headerlink" href="#minimal-configuration" title="Link to this heading">¶</a></h2>
<p>Configure timing registers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="n">I3C_EC</span><span class="o">.</span><span class="n">SOCMGMTIF</span><span class="o">.</span><span class="n">T_R_REG</span> <span class="o">=</span> <span class="mh">0x2</span>
<span class="n">I3C_EC</span><span class="o">.</span><span class="n">SOCMGMTIF</span><span class="o">.</span><span class="n">T_HD_DAT_REG</span> <span class="o">=</span> <span class="mh">0xA</span>
<span class="n">I3C_EC</span><span class="o">.</span><span class="n">SOCMGMTIF</span><span class="o">.</span><span class="n">T_SU_DAT_REG</span> <span class="o">=</span>  <span class="mh">0xA</span>
</code></pre></div>
</div>
<p>Configure the static address to a desired value and set valid bit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="n">I3C_EC</span><span class="o">.</span><span class="n">STDBYCTRLMODE</span><span class="o">.</span><span class="n">STBY_CR_DEVICE_ADDR</span><span class="o">.</span><span class="n">STATIC_ADDR</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
<span class="n">I3C_EC</span><span class="o">.</span><span class="n">STDBYCTRLMODE</span><span class="o">.</span><span class="n">STBY_CR_DEVICE_ADDR</span><span class="o">.</span><span class="n">STATIC_ADDR_VALID</span> <span class="o">=</span> <span class="mh">0x1</span>
</code></pre></div>
</div>
<p>Enable Standby Configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="n">I3C_EC</span><span class="o">.</span><span class="n">STDBYCTRLMODE</span><span class="o">.</span><span class="n">STBY_CR_CONTROL</span><span class="o">.</span><span class="n">STBY_CR_ENABLE_INIT</span> <span class="o">=</span> <span class="mh">0x2</span>
</code></pre></div>
</div>
<p>Enable Target Transaction Interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="n">I3C_EC</span><span class="o">.</span><span class="n">STDBYCTRLMODE</span><span class="o">.</span><span class="n">STBY_CR_CONTROL</span><span class="o">.</span><span class="n">TARGET_XACT_ENABLE</span> <span class="o">=</span> <span class="mh">0x1</span>
</code></pre></div>
</div>
<p>Enable PHY:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="n">I3CBASE</span><span class="o">.</span><span class="n">HC_CONTROL</span><span class="o">.</span><span class="n">BUS_ENABLE</span> <span class="o">=</span> <span class="mh">0x1</span>
</code></pre></div>
</div>


  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      2024-12-19
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="timings.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Electrical and timing specifications" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Electrical and timing specifications
            </div>
          </div>
        </a>
      
      
        
        <a href="normal_operation.html" class="md-footer__link md-footer__link--next" aria-label="Next: Normal operation" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Normal operation
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        Copyright &#169; Antmicro, 2024.
        
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/antmicro" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/antmicro" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["toc.integrate"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="_static/sphinx_immaterial_theme.f9d9eeeb247ace16c.min.js?v=8ec58cb5"></script>
    
  </body>
</html>