

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="">
    
    
      
        <title>Normal operation - I3C Core - documentation</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="_static/sphinx_immaterial_theme.4b4a8c74e2ff2ab5b.min.css?v=afa97f93" />
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="I3C Core - documentation" class="md-header__button md-logo" aria-label="I3C Core - documentation" data-md-component="logo">
      <img src="_static/white.svg" alt="logo">
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            I3C Core - documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Normal operation
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <div class="md-header__button">
        <a href="i3c-core--documentation.pdf" title="PDF - i3c-core--documentation.pdf">
          <div class="md-icon">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M64 0C28.7 0 0 28.7 0 64v384c0 35.3 28.7 64 64 64h256c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zm192 0v128h128L256 0zM64 224h24c30.9 0 56 25.1 56 56s-25.1 56-56 56h-8v32c0 8.8-7.2 16-16 16s-16-7.2-16-16V240c0-8.8 7.2-16 16-16zm24 80c13.3 0 24-10.7 24-24s-10.7-24-24-24h-8v48h8zm72-64c0-8.8 7.2-16 16-16h24c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48h-24c-8.8 0-16-7.2-16-16V240zm32 112h8c8.8 0 16-7.2 16-16v-64c0-8.8-7.2-16-16-16h-8v96zm96-128h48c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v32h32c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v48c0 8.8-7.2 16-16 16s-16-7.2-16-16V240c0-8.8 7.2-16 16-16z"/></svg>
          </div>
        </a>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="I3C Core - documentation" class="md-nav__button md-logo" aria-label="I3C Core - documentation" data-md-component="logo">
      <img src="_static/white.svg" alt="logo">
    </a>
    I3C Core - documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        <span class="md-ellipsis">Introduction</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2">
          <span class="md-ellipsis">Hardware Design and Verification</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hardware Design and Verification" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Hardware Design and Verification</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="top.html" class="md-nav__link">
        <span class="md-ellipsis">Overview</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="controller_interfaces.html" class="md-nav__link">
        <span class="md-ellipsis">Controller Interfaces</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="controller_standby.html" class="md-nav__link">
        <span class="md-ellipsis">Standby Controller</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="controller_phy.html" class="md-nav__link">
        <span class="md-ellipsis">Physical Layer</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="dv.html" class="md-nav__link">
        <span class="md-ellipsis">Design verification</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="ci_queues.html" class="md-nav__link">
        <span class="md-ellipsis">Controller Interface Queues</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="timings.html" class="md-nav__link">
        <span class="md-ellipsis">Electrical and timing specifications</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3">
          <span class="md-ellipsis">Programmer&#39;s Reference Manual</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Programmer&#39;s Reference Manual" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Programmer&#39;s Reference Manual</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="initialization.html" class="md-nav__link">
        <span class="md-ellipsis">Boot and Initialization</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span class="md-ellipsis">Normal operation</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span class="md-ellipsis">Normal operation</span>
      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-transfers" class="md-nav__link">
    <span class="md-ellipsis">Data transfers</span>
  </a>
  
    <nav class="md-nav" aria-label="Data transfers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-descriptors" class="md-nav__link">
    <span class="md-ellipsis">Command Descriptors</span>
  </a>
  
    <nav class="md-nav" aria-label="Command Descriptors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#immediate-transfer" class="md-nav__link">
    <span class="md-ellipsis">Immediate transfer</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regular-transfer" class="md-nav__link">
    <span class="md-ellipsis">Regular transfer</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-descriptor" class="md-nav__link">
    <span class="md-ellipsis">Response descriptor</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-band-interrupts-ibi-handling" class="md-nav__link">
    <span class="md-ellipsis">In-<wbr>band interrupts <wbr>(IBI) handling</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interrupts" class="md-nav__link">
    <span class="md-ellipsis">Interrupts</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#address-assignment" class="md-nav__link">
    <span class="md-ellipsis">Address Assignment</span>
  </a>
  
    <nav class="md-nav" aria-label="Address Assignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#device-management" class="md-nav__link">
    <span class="md-ellipsis">Device Management</span>
  </a>
  
    <nav class="md-nav" aria-label="Device Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#device-attach-enumeration-and-initialization" class="md-nav__link">
    <span class="md-ellipsis">Device Attach, Enumeration, and Initialization</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#device-detach-reset-and-power-management" class="md-nav__link">
    <span class="md-ellipsis">Device Detach, Reset, and Power Management</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#device-context" class="md-nav__link">
    <span class="md-ellipsis">Device Context</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#device-addressing" class="md-nav__link">
    <span class="md-ellipsis">Device Addressing</span>
  </a>
  
    <nav class="md-nav" aria-label="Device Addressing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dynamic-address-assignment-with-entdaa" class="md-nav__link">
    <span class="md-ellipsis">Dynamic Address Assignment with ENTDAA</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-static-addresses" class="md-nav__link">
    <span class="md-ellipsis">Using Static Addresses</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grouped-addressing" class="md-nav__link">
    <span class="md-ellipsis">Grouped Addressing</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux-kernel" class="md-nav__link">
    <span class="md-ellipsis">Linux Kernel</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4">
          <span class="md-ellipsis">Extended Capabilities and Recovery Flow</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Extended Capabilities and Recovery Flow" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Extended Capabilities and Recovery Flow</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="ext_cap.html" class="md-nav__link">
        <span class="md-ellipsis">Specification for I3C Vendor-<wbr>Specific Extended Capabilities</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="recovery_flow.html" class="md-nav__link">
        <span class="md-ellipsis">Recovery flow</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5">
          <span class="md-ellipsis">Integrating the I3C Core</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Integrating the I3C Core" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Integrating the I3C Core</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="config.html" class="md-nav__link">
        <span class="md-ellipsis">Configuring the I3C Core</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="integration.html" class="md-nav__link">
        <span class="md-ellipsis">Integration with Caliptra Subsystem</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="testing.html" class="md-nav__link">
        <span class="md-ellipsis">FPGA Validation Platform</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


<h1 id="normal-operation">Normal operation<a class="headerlink" href="#normal-operation" title="Link to this heading">¶</a></h1>
<p>The following section details the software driver side of the normal operation: issuing <a class="reference internal" href="#data-transfers">data transfers</a>, <a class="reference internal" href="#in-band-interrupts-ibi-handling">IBI interrupts</a>, <a class="reference internal" href="#interrupts">interrupts</a> handling and <a class="reference internal" href="#address-assignment">address assignment</a> procedure.</p>
<h2 id="data-transfers">Data transfers<a class="headerlink" href="#data-transfers" title="Link to this heading">¶</a></h2>
<p>I3C HCI specification allows two data transfer modes: DMA and PIO. In DMA mode the driver populates DMA descriptors to the core via its registers and instructs it to execute a transfer. In PIO mode certain registers are used to access FIFO queues and the driver needs to actively read/write data from/to them.</p>
<p>Our implementation supports PIO mode only.</p>
<p>According to “6.8.1 Transfers in PIO mode” and “6.12.1 PIO Mode” sections of the HCI spec, the driver issues transfers to the core in the following manner:</p>
<ul class="simple">
<li><p>If data is to be transmitted to a device, the driver writes it to the Tx data queue by writing to the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#xfer_data_port-register">XFER_DATA_PORT</a> register. Some commands allow providing data as the immediate payload - for those no data needs to be written to the Tx queue.</p></li>
<li><p>The driver writes a command descriptor to the command queue port by writing the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#command_port-register">COMMAND_PORT</a> register.</p></li>
<li><p>The controller executes the transfer. To indicate transfer completion the core may report an interrupt.</p></li>
<li><p>Once the transfer is complete, the driver reads command status from the response queue and the received data (if any) from the Rx data queue.</p></li>
</ul>
<p>Collecting responses and received data:</p>
<ul class="simple">
<li><p>A response is provided by the controller to the driver in the following cases:</p>
<ul>
<li><p>When a transfer is successful and the <code class="docutils literal notranslate"><span class="pre">wroc</span></code> field is set in the corresponding command descriptor.</p></li>
<li><p>When a read transfer is successful (denoted by the <code class="docutils literal notranslate"><span class="pre">rnw</span></code> field).</p></li>
<li><p>When a transfer generates an error (e.g. a short read request with the <code class="docutils literal notranslate"><span class="pre">short_read_err</span></code> field set).</p></li>
</ul>
</li>
<li><p>Driver can fetch the response descriptor by issuing a read from the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#response_port-register">RESPONSE_PORT</a> register.</p>
<ul>
<li><p>Reaching the response threshold is indicated with the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#resp_ready-field">RESP_READY_STAT</a> field by the controller when <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#resp_ready_en-field">RESP_READY_STAT_EN</a> is set.
A threshold interrupt is raised in accordance to <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#resp_buf-field">RESP_BUF_THLD</a>.</p></li>
<li><p>In case of a read request when no response is available, the controller raises an error on the frontend bus interface (AHB / AXI).</p></li>
<li><p>Upon a successful read from the <code class="docutils literal notranslate"><span class="pre">RESPONSE_PORT</span></code>, the driver is to decode the response in accordance to the <a class="reference internal" href="#response-descriptor">response descriptor</a> definition and verify the <code class="docutils literal notranslate"><span class="pre">tid</span></code>.
The <code class="docutils literal notranslate"><span class="pre">tid</span></code> should match the <code class="docutils literal notranslate"><span class="pre">tid</span></code> of a previously enqueued command.</p></li>
</ul>
</li>
<li><p>Received transfer data can be obtained by the driver via a read from the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#xfer_data_port-register">XFER_DATA_PORT</a> register.</p>
<ul>
<li><p>Reaching the received data threshold is indicated by the controller with the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#rx_threshold-field">TX_THLD_STAT</a> interrupt if <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#rx_threshold_en-field">RX_THLD_STAT_EN</a> is set.
The RX threshold can be set via <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#rx_buf-field">RX_BUF_THLD</a>.</p></li>
<li><p>In case of a read when no RX data is available, the controller raises an error on the frontend bus interface (AHB / AXI).</p></li>
</ul>
</li>
</ul>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">XFER_DATA_PORT</span></code> register is dual-purpose - when writing data is passed to the Tx queue, and when reading data is fetched from the Rx queue.</p>
<p>Section “8.4 Command Descriptor” describes in detail the format of commands for the core. Section “8.5 Response Descriptor” describes the structure of a response from the core.</p>
<h3 id="command-descriptors">Command Descriptors<a class="headerlink" href="#command-descriptors" title="Link to this heading">¶</a></h3>
<h4 id="immediate-transfer">Immediate transfer<a class="headerlink" href="#immediate-transfer" title="Link to this heading">¶</a></h4>
<table class="docutils data align-default" id="id1">
<caption><span class="caption-number">Table 1 </span><span class="caption-text"><em>Immediate transfer descriptor</em></span><a class="headerlink" href="#id1" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 10.0%" />
<col style="width: 22.0%" />
<col style="width: 68.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Range</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>[63:56]</p></td>
<td><p>data_byte4</p></td>
<td><p>4th byte of the data for the transfer</p></td>
</tr>
<tr class="row-odd"><td><p>[55:48]</p></td>
<td><p>data_byte3</p></td>
<td><p>3rd byte of the data for the transfer</p></td>
</tr>
<tr class="row-even"><td><p>[47:40]</p></td>
<td><p>data_byte2</p></td>
<td><p>2nd byte of the data for the transfer</p></td>
</tr>
<tr class="row-odd"><td><p>[39:32]</p></td>
<td><p>def_or_data_byte1</p></td>
<td><p>Defining byte or a 1st byte of the data for the transfer</p></td>
</tr>
<tr class="row-even"><td><p>[31]</p></td>
<td><p>toc</p></td>
<td><p>Terminate on completion</p>
<p><code class="docutils literal notranslate"><span class="pre">1'b0</span></code>: Restart after the end of the transfer</p>
<p><code class="docutils literal notranslate"><span class="pre">1'b1</span></code>: Stop at the end of the transfer</p>
</td>
</tr>
<tr class="row-odd"><td><p>[30]</p></td>
<td><p>wroc</p></td>
<td><p>If set, send response on completion of the successful transfer</p></td>
</tr>
<tr class="row-even"><td><p>[29]</p></td>
<td><p>rnw</p></td>
<td><p>Direction;
Must be set to <code class="docutils literal notranslate"><span class="pre">0'b0</span></code> - immediate transfers are write only</p></td>
</tr>
<tr class="row-odd"><td><p>[28:26]</p></td>
<td><p>mode</p></td>
<td><p>Mode and speed of the transfer</p>
<p><code class="docutils literal notranslate"><span class="pre">3'b000</span></code>: SDR0 - Standard SDR speed (up to 12.5 MHZ)</p>
<p><code class="docutils literal notranslate"><span class="pre">3'b001</span></code> - <code class="docutils literal notranslate"><span class="pre">3'b100</span></code>: SDR1 - SDR4 - Reduced data rates</p>
<p><code class="docutils literal notranslate"><span class="pre">3'b101</span></code>: HDR TSx - HDR ternary mode</p>
<p><code class="docutils literal notranslate"><span class="pre">3'b110</span></code>: HDR DDR - HDR double data rate mode</p>
<p><code class="docutils literal notranslate"><span class="pre">3'b111</span></code>: Reserved</p>
</td>
</tr>
<tr class="row-even"><td><p>[25:23]</p></td>
<td><p>dtt</p></td>
<td><p>Type and Byte count
Number of valid data bytes</p></td>
</tr>
<tr class="row-odd"><td><p>[22:21]</p></td>
<td><p>__rsvd22_21</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-even"><td><p>[20:16]</p></td>
<td><p>dev_index</p></td>
<td><p>Device index indicating DAT table index for the target device</p></td>
</tr>
<tr class="row-odd"><td><p>[15]</p></td>
<td><p>cp</p></td>
<td><p>Command present
Indicates validity of the <code class="docutils literal notranslate"><span class="pre">cmd</span></code> field</p></td>
</tr>
<tr class="row-even"><td><p>[14:7]</p></td>
<td><p>cmd</p></td>
<td><p>CCC / HDR command code value</p></td>
</tr>
<tr class="row-odd"><td><p>[6:3]</p></td>
<td><p>tid</p></td>
<td><p>Transaction ID</p></td>
</tr>
<tr class="row-even"><td><p>[2:0]</p></td>
<td><p>cmd_attr</p></td>
<td><p>Command Attribute
Must be <code class="docutils literal notranslate"><span class="pre">3'b001</span></code></p></td>
</tr>
</tbody>
</table>
<h4 id="regular-transfer">Regular transfer<a class="headerlink" href="#regular-transfer" title="Link to this heading">¶</a></h4>
<table class="docutils data align-default" id="id2">
<caption><span class="caption-number">Table 2 </span><span class="caption-text"><em>Regular transfer descriptor</em></span><a class="headerlink" href="#id2" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 10.0%" />
<col style="width: 20.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Range</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>[63:48]</p></td>
<td><p>data_length</p></td>
<td><p>Transfer’s data length</p></td>
</tr>
<tr class="row-odd"><td><p>[47:40]</p></td>
<td><p>__rsvd47_40</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-even"><td><p>[39:32]</p></td>
<td><p>def_byte</p></td>
<td><p>Defining byte</p></td>
</tr>
<tr class="row-odd"><td><p>[31]</p></td>
<td><p>toc</p></td>
<td><p>Terminate on completion</p>
<p><code class="docutils literal notranslate"><span class="pre">1'b0</span></code>: Restart after the end of the transfer</p>
<p><code class="docutils literal notranslate"><span class="pre">1'b1</span></code>: Stop at the end of the transfer</p>
</td>
</tr>
<tr class="row-even"><td><p>[30]</p></td>
<td><p>wroc</p></td>
<td><p>If set send response on completion of the successful transfer</p></td>
</tr>
<tr class="row-odd"><td><p>[29]</p></td>
<td><p>rnw</p></td>
<td><p>Direction;</p>
<p><code class="docutils literal notranslate"><span class="pre">1'b0</span></code>: Write transfer</p>
<p><code class="docutils literal notranslate"><span class="pre">1'b1</span></code>: Read transfer</p>
</td>
</tr>
<tr class="row-even"><td><p>[28:26]</p></td>
<td><p>mode</p></td>
<td><p>Mode and speed of the transfer</p>
<p><code class="docutils literal notranslate"><span class="pre">3'b000</span></code>: SDR0 - Standard SDR speed (up to 12.5 MHZ)</p>
<p><code class="docutils literal notranslate"><span class="pre">3'b001</span></code> - <code class="docutils literal notranslate"><span class="pre">3'b100</span></code>: SDR1 - SDR4 - Reduced data rates</p>
<p><code class="docutils literal notranslate"><span class="pre">3'b101</span></code>: HDR TSx - HDR ternary mode</p>
<p><code class="docutils literal notranslate"><span class="pre">3'b110</span></code>: HDR DDR - HDR double data rate mode</p>
<p><code class="docutils literal notranslate"><span class="pre">3'b111</span></code>: Reserved</p>
</td>
</tr>
<tr class="row-odd"><td><p>[25]</p></td>
<td><p>dbp</p></td>
<td><p>Defining Byte for CCC present
If <code class="docutils literal notranslate"><span class="pre">1'b1</span></code> the <code class="docutils literal notranslate"><span class="pre">def_byte</span></code> contains defining byte</p></td>
</tr>
<tr class="row-even"><td><p>[24]</p></td>
<td><p>short_read_err</p></td>
<td><p>If <code class="docutils literal notranslate"><span class="pre">1'b0</span></code> short reads are allowed
Otherwise, short reads are treated as an error</p></td>
</tr>
<tr class="row-odd"><td><p>[23:21]</p></td>
<td><p>__rsvd23_21</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-even"><td><p>[20:16]</p></td>
<td><p>dev_index</p></td>
<td><p>Device index indicating DAT table index for the target device</p></td>
</tr>
<tr class="row-odd"><td><p>[15]</p></td>
<td><p>cp</p></td>
<td><p>Command present
Indicates validity of the <code class="docutils literal notranslate"><span class="pre">cmd</span></code> field</p></td>
</tr>
<tr class="row-even"><td><p>[14:7]</p></td>
<td><p>cmd</p></td>
<td><p>CCC / HDR command code value</p></td>
</tr>
<tr class="row-odd"><td><p>[6:3]</p></td>
<td><p>tid</p></td>
<td><p>Transaction ID</p></td>
</tr>
<tr class="row-even"><td><p>[2:0]</p></td>
<td><p>cmd_attr</p></td>
<td><p>Command Attribute
Must be <code class="docutils literal notranslate"><span class="pre">3'b000</span></code></p></td>
</tr>
</tbody>
</table>
<h3 id="response-descriptor">Response descriptor<a class="headerlink" href="#response-descriptor" title="Link to this heading">¶</a></h3>
<table class="docutils data align-default" id="id3">
<caption><span class="caption-number">Table 3 </span><span class="caption-text"><em>Response descriptor</em></span><a class="headerlink" href="#id3" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 10.0%" />
<col style="width: 20.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Range</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>[31:28]</p></td>
<td><p>err_status</p></td>
<td><p>Error status</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">4'b0000</span></code>: Success</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4'b0001</span></code>: CRC</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4'b0010</span></code>: Parity</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4'b0011</span></code>: Frame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4'b0100</span></code>: Address Header</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4'b0101</span></code>: Address was NACK’ed or Dynamic Address Assignment was NACK’ed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4'b0110</span></code>: Received overflow or transfer underflow</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4'b0111</span></code>: Target returned fewer bytes than requested in <code class="docutils literal notranslate"><span class="pre">DATA_LENGTH</span></code> field of a transfer command where short read was not permitted</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4'b1000</span></code>: Terminated by controller due to internal error or Abort operation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4'b1001</span></code>: Transfer terminated by due to bus action:</p>
<ul>
<li><p>for I2C transfers: <code class="docutils literal notranslate"><span class="pre">I2C_WR_DATA_NACK</span></code></p></li>
<li><p>for I3C transfers: <code class="docutils literal notranslate"><span class="pre">BUS_ABORTED</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">4'b1010</span></code>: Command not supported by the Controller implementation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4'b1011</span></code>: Reserved</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4'b1100</span></code> - <code class="docutils literal notranslate"><span class="pre">4'b1111</span></code>: Transfer Type Specific Errors</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>[27:24]</p></td>
<td><p>tid</p></td>
<td><p>Transaction ID; should match the tid of the previously enqueued command</p></td>
</tr>
<tr class="row-even"><td><p>[23:16]</p></td>
<td><p>__rsvd23_16</p></td>
<td><p>Reserved</p></td>
</tr>
<tr class="row-odd"><td><p>[15:0]</p></td>
<td><p>data_length</p></td>
<td><ul class="simple">
<li><p>Received data in case of write transfers</p></li>
<li><p>Remaining data in case of read transfers</p></li>
<li><p>Remaining device count in case of address assignment procedure</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<h2 id="in-band-interrupts-ibi-handling">In-band interrupts (IBI) handling<a class="headerlink" href="#in-band-interrupts-ibi-handling" title="Link to this heading">¶</a></h2>
<p>IBI are interrupts reported by I3C devices via in-band signaling on the bus (section “6.9.1 IBI Handling in PIO Mode”):</p>
<ul class="simple">
<li><p>When the controller receives IBI from a target device, it stores it in the IBI queue. Once the queue occupancy exceeds the threshold set by <code class="docutils literal notranslate"><span class="pre">IBI_STATUS_THLD_STAT</span></code> of the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#queue_thld_ctrl-register">QUEUE_THLD_CTRL</a> register, an interrupt is triggered.</p></li>
<li><p>IBI descriptors can then be read from the IBI data queue via the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#ibi_port-register">IBI_PORT</a> register.</p></li>
</ul>
<p>IBI status descriptor structure is described in “8.6 IBI Status Descriptor” chapter of the spec.</p>
<h2 id="interrupts">Interrupts<a class="headerlink" href="#interrupts" title="Link to this heading">¶</a></h2>
<p>Events related to transfers trigger certain interrupts in the core that are signaled to the host. Individual interrupt signals can be enabled or disabled via the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#pio_intr_signal_enable-register">PIO_INTR_SIGNAL_ENABLE</a> register.</p>
<p>Interrupts status can be read from the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#pio_intr_status_enable-register">PIO_INTR_STATUS</a> register.</p>
<p>Interrupts related to Tx and Rx data queues, namely <code class="docutils literal notranslate"><span class="pre">TX_THLD_SIGNAL_EN</span></code> and <code class="docutils literal notranslate"><span class="pre">RX_THLD_SIGNAL_EN</span></code>, are triggered when queue occupancy rises above / falls below a certain threshold. These thresholds are controlled by fields of the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#data_buffer_thld_ctrl-register">DATA_BUFFER_THLD_CTRL</a> register:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RX_BUF_THLD</span></code> for the receive queue,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TX_BUF_THLD</span></code> for the transmit queue.</p></li>
</ul>
<p>For command, response and IBI queues the register <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#queue_thld_ctrl-register">QUEUE_THLD_CTRL</a> defines thresholds for interrupt triggering:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IBI_STATUS_THLD</span></code> for IBI status queue,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IBI_DATA_THLD</span></code> for IBI data queue,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RESP_BUF_THLD</span></code> and <code class="docutils literal notranslate"><span class="pre">CMD_EMPTY_BUF_THLD</span></code> for command response queue.</p></li>
</ul>
<p>There’s also the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#pio_intr_force-register">PIO_INTR_FORCE</a> register that allows force triggering certain interrupts for debugging purposes.</p>
<h2 id="address-assignment">Address Assignment<a class="headerlink" href="#address-assignment" title="Link to this heading">¶</a></h2>
<h3 id="device-management">Device Management<a class="headerlink" href="#device-management" title="Link to this heading">¶</a></h3>
<h4 id="device-attach-enumeration-and-initialization">Device Attach, Enumeration, and Initialization<a class="headerlink" href="#device-attach-enumeration-and-initialization" title="Link to this heading">¶</a></h4>
<p>The Controller assigns a dynamic address for each device on the I3C Bus. For devices with static addresses, the dynamic address is equal to the static address. Each device must have its entry in the Device Address Table (DAT) before initiating dynamic address assignment. Each DAT entry must contain a field value in either <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#static_addr-field">STATIC_ADDRESS</a> (if it is known) or <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#dynamic_adr-field">DYNAMIC_ADDRESS</a>.
Once the DAT table is set up, the software driver should follow at least one of the following scenarios (while keeping the order):</p>
<ol class="arabic simple">
<li><p>Send the <code class="docutils literal notranslate"><span class="pre">SETDASA</span></code> CCC to assign a static address for a chosen device  or send the <code class="docutils literal notranslate"><span class="pre">SETAASA</span></code> CCC to assign a static address for all devices with known static address.</p></li>
<li><p>Send <code class="docutils literal notranslate"><span class="pre">ENTDAA</span></code> CCC to initiate the procedure of dynamic address assignment for all devices configured in DAT.</p></li>
</ol>
<p>After finishing the <code class="docutils literal notranslate"><span class="pre">ENTDAA</span></code> process, the Device Characteristic Table (DCT) will be updated with values read from the devices configured on the I3C Bus.</p>
<p>The initial bus enumeration process should be performed in the following order:</p>
<ol class="arabic simple">
<li><p>Check sizes of DAT and DCT by reading <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#dat_section_offset-register">DAT_SECTION_OFFSET</a> and <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#dct_section_offset-register">DCT_SECTION_OFFSET</a>.</p></li>
<li><p>Set up DAT entries for devices with static addresses and send the <code class="docutils literal notranslate"><span class="pre">SETDASA</span></code>/<code class="docutils literal notranslate"><span class="pre">SETAASA</span></code> CCC.</p></li>
<li><p>Set up DAT entries for devices with dynamic addresses and send the <code class="docutils literal notranslate"><span class="pre">ENTDAA</span></code> CCC.</p></li>
<li><p>If any I3C device needs to change the dynamic address, send the <code class="docutils literal notranslate"><span class="pre">SETNEWDA</span></code> CCC to assign a new address and ensure there is no error on the bus.</p></li>
</ol>
<p>In case of incorrect results of the Dynamic Addressing procedure, the software can either send the <code class="docutils literal notranslate"><span class="pre">SETNEWDA</span></code> CCC to the misconfigured devices or send the <code class="docutils literal notranslate"><span class="pre">RSTDAA</span></code> CCC to reset all dynamic addresses and then repeat the Dynamic Addressing procedure.</p>
<p>Hot-Join requests from I3C Target Devices should be handled automatically by the Host Controller. The driver should detect the Hot-Join IBI and populate a new entry in the DAT table.</p>
<p>The driver should always refer to a device entry in the DAT table to schedule a transfer. The Controller will use an appropriate address (either static or dynamic) that matches such an entry. For I2C devices, the static address will always be used.</p>
<h4 id="device-detach-reset-and-power-management">Device Detach, Reset, and Power Management<a class="headerlink" href="#device-detach-reset-and-power-management" title="Link to this heading">¶</a></h4>
<p>Upon a device detach event, the DAT entry will not be altered. The assigned address is reserved, the software can re-use it by executing an address assignment command targeting the specific DAT entry.</p>
<p>If the detached device re-attaches to the bus, it will use the same DAT entry as before if it was not overwritten.</p>
<p>Once the new device joins the bus, it should wait for the Controller to assign a dynamic address.</p>
<p>Since there can be an offline capable device, it might not respond to directed commands immediately and the driver should allow devices to take time to respond, with retries and/or longer timeout.</p>
<h4 id="device-context">Device Context<a class="headerlink" href="#device-context" title="Link to this heading">¶</a></h4>
<p>The context of a device on the bus is realized through the DAT and the DCT tables. The DCT table is transient and can be significantly smaller than the DAT, since it is only used during the address assignment procedure (<code class="docutils literal notranslate"><span class="pre">ENTDAA</span></code>). The software should copy contents of a DCT entry to the internal driver context, on a per-device basis.</p>
<p>The software can disable the Controller Role Request (CRR) and In-Band Interrupt (IBI) for each device in their respective DAT entries. If either CRR or IBI should be re-enabled, the driver should modify the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#crr_reject-field">CRR_REJECT</a>/<a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#ibi_reject-field">IBI_REJECT</a> field in DAT and send the <code class="docutils literal notranslate"><span class="pre">ENEC</span></code> CCC to such a device.</p>
<p>If IBIs were disabled using the target IBI credit mechanism, and the target’s credit counter is zero, then the Host Controller will automatically re-enable IBIs for that Target using the <code class="docutils literal notranslate"><span class="pre">ENEC</span></code> CCC, after the software writes to that Target’s <code class="docutils literal notranslate"><span class="pre">TARGET_CREDIT_N</span></code> register.</p>
<h3 id="device-addressing">Device Addressing<a class="headerlink" href="#device-addressing" title="Link to this heading">¶</a></h3>
<h4 id="dynamic-address-assignment-with-entdaa">Dynamic Address Assignment with ENTDAA<a class="headerlink" href="#dynamic-address-assignment-with-entdaa" title="Link to this heading">¶</a></h4>
<p>Each I3C target device that supports the ENTDAA procedure and that has not been assigned static addresses should have assigned a dynamic address during the Dynamic Address Assignment procedure based on the DAT table entry. For each DAT entry, software should:</p>
<ul class="simple">
<li><p>Set the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#dev-field">DEVICE</a> field to indicate the Device’s type</p></li>
<li><p>Set the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#dynamic_adr-field">DYNAMIC_ADDRESS</a> field to indicate the Device’s preferred Dynamic Address</p></li>
</ul>
<p>After DAT configuration, the software should:</p>
<ol class="arabic simple">
<li><p>Enqueue one or more Command Descriptors of Address Assignment Command type for the <code class="docutils literal notranslate"><span class="pre">ENTDAA</span></code> CCC, using the steps listed in Section 8.4.1.1</p></li>
<li><p>Wait for a response and ensure that the response descriptor indicates a successful result</p></li>
<li><p>For each successful response: read the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#pid_hi-field">PID</a>, <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#bcr-field">BCR</a> and <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#dcr-field">DCR</a> values from the appropriate fields of the indicated entries in the DCT for the assigned Dynamic Address(es) as part of the <code class="docutils literal notranslate"><span class="pre">ENTDAA</span></code> process:
A. Note that these values are transient, so software must read them and save them internally before performing subsequent Address Assignment commands with the <code class="docutils literal notranslate"><span class="pre">ENTDAA</span></code> CCC
B. Each DCT entry for a successful assignment with the <code class="docutils literal notranslate"><span class="pre">ENTDAA</span></code> modal flow should have the same value in the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#dynamic_addr-field-1">DYNAMIC_ADDRESS</a> field as the corresponding  <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#dynamic_adr-field">DYNAMIC_ADDRESS</a> DAT entry that was used for the I3C Device to which this address was assigned</p></li>
</ol>
<p>If the address assignment command completes with <strong>NACK</strong>, it means one of following:</p>
<ul class="simple">
<li><p>There are no I3C devices available to participate</p></li>
<li><p>Not all devices were assigned an address, this is indicated by the <code class="docutils literal notranslate"><span class="pre">DATA_LENGTH</span></code> value in the response descriptor lower than the <code class="docutils literal notranslate"><span class="pre">DEV_COUNT</span></code> value in the command descriptor</p></li>
<li><p>There were no addresses assigned to any devices (no I3C devices responded), this is indicated by the <code class="docutils literal notranslate"><span class="pre">DATA_LENGTH</span></code> value in the response descriptor equal to the <code class="docutils literal notranslate"><span class="pre">DEV_COUNT</span></code> value in the command descriptor</p></li>
</ul>
<h4 id="using-static-addresses">Using Static Addresses<a class="headerlink" href="#using-static-addresses" title="Link to this heading">¶</a></h4>
<p>For each I3C target device with a known address and each I2C target device, software will write this address to the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#static_addr-field">STATIC_ADDRESS</a> field  of the respective DAT table entry. For each such DAT entry, the software will:</p>
<ul class="simple">
<li><p>Set the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#dev-field">DEVICE</a> field to indicate the Device’s type</p></li>
<li><p>Set the <a class="reference external" href="https://github.com/chipsalliance/i3c-core-rdl/blob/main/src/csr/documentation.md#dynamic_adr-field">DYNAMIC_ADDRESS</a> field to indicate the Device’s preferred Dynamic Address</p></li>
</ul>
<p>After DAT configuration, the software will:</p>
<ol class="arabic simple">
<li><p>For I3C devices configured with the <code class="docutils literal notranslate"><span class="pre">SETDASA</span></code> CCC:
A. Enqueue one or more command descriptors of address assignment command type for the <code class="docutils literal notranslate"><span class="pre">SETDASA</span></code> CCC, using the steps listed in Section 8.4.1.2
B. Wait for a response and ensure that the response descriptor indicates a successful result</p></li>
<li><p>For those I3C Devices which will be configured with the <code class="docutils literal notranslate"><span class="pre">SETAASA</span></code> CCC:
A. Enqueue one command descriptor of immediate data transfer command type for the <code class="docutils literal notranslate"><span class="pre">SETAASA</span></code> Broadcast CCC, as a standard CCC (i.e., not an address assignment command)
B. Wait for a response and ensure that the response descriptor indicates a successful result</p></li>
</ol>
<p>If the address assignment command for <code class="docutils literal notranslate"><span class="pre">SETDASA</span></code> completes with <strong>NACK</strong>, it means that the configured device is not present, or was not ready, or did not detect the <code class="docutils literal notranslate"><span class="pre">SETDASA</span></code> CCC on the bus.</p>
<p>If the address assignment command for <code class="docutils literal notranslate"><span class="pre">SETAASA</span></code> completes with <strong>NACK</strong>, there is no method to determine the status of any individual I3C target device that was asked to assign its own static address as dynamic address.</p>
<h4 id="grouped-addressing">Grouped Addressing<a class="headerlink" href="#grouped-addressing" title="Link to this heading">¶</a></h4>
<p>The I3C Controller supports grouping multiple I3C target devices to manage multiple devices at a single address. Since group addresses share the same address space as valid I3C dynamic addresses, the software must avoid assigning conflicting addresses (i.e., dynamic and group addresses having the same value).</p>
<p>Possible operations for group management:</p>
<ul class="simple">
<li><p>The Controller may assign the I3C target device to a group address by sending a direct <code class="docutils literal notranslate"><span class="pre">SETGRPA</span></code> CCC addressed to a dynamic address</p></li>
<li><p>The Controller may assign the I3C target device to a group address by sending a direct <code class="docutils literal notranslate"><span class="pre">RSTGRPA</span></code> CCC addressed to either a dynamic address or a group address</p></li>
<li><p>The Controller may disband all groups by sending a broadcast <code class="docutils literal notranslate"><span class="pre">RSTGRPA</span></code> CCC</p></li>
</ul>
<p>Each group address must have a dedicated DAT entry which can be accessed from the Controller for write-type transfers. The software should not perform read operations on group addresses.</p>
<h2 id="linux-kernel">Linux Kernel<a class="headerlink" href="#linux-kernel" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/torvalds/linux/tree/master/drivers/i3c/master">Linux driver for I3C Controller Mode</a></p></li>
<li><p><a class="reference external" href="https://patchwork.kernel.org/project/linux-i3c/list/?series=851338">Pending patch for adding I3C target mode support in the Linux Kernel</a></p></li>
</ul>


  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      2024-12-17
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="initialization.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Boot and Initialization" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Boot and Initialization
            </div>
          </div>
        </a>
      
      
        
        <a href="ext_cap.html" class="md-footer__link md-footer__link--next" aria-label="Next: Specification for I3C Vendor-Specific Extended Capabilities" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Specification for I3C Vendor-Specific Extended Capabilities
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        Copyright &#169; Antmicro, 2024.
        
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/antmicro" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/antmicro" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["toc.integrate"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="_static/sphinx_immaterial_theme.f9d9eeeb247ace16c.min.js?v=8ec58cb5"></script>
    
  </body>
</html>