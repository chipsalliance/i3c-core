

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="">
    
    
      
        <title>Recovery flow - CHIPS Alliance Caliptra Open Source I3C core</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="_static/sphinx_immaterial_theme.02cb18745d09eea51.min.css?v=ff456132" />
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="CHIPS Alliance Caliptra Open Source I3C core" class="md-header__button md-logo" aria-label="CHIPS Alliance Caliptra Open Source I3C core" data-md-component="logo">
      <img src="_static/white.svg" alt="logo">
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CHIPS Alliance Caliptra Open Source I3C core
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Recovery flow
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <div class="md-header__button">
        <a href="i3c-core-docs.pdf" title="PDF - i3c-core-docs.pdf">
          <div class="md-icon">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M64 0C28.7 0 0 28.7 0 64v384c0 35.3 28.7 64 64 64h256c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zm192 0v128h128L256 0zM64 224h24c30.9 0 56 25.1 56 56s-25.1 56-56 56h-8v32c0 8.8-7.2 16-16 16s-16-7.2-16-16V240c0-8.8 7.2-16 16-16zm24 80c13.3 0 24-10.7 24-24s-10.7-24-24-24h-8v48h8zm72-64c0-8.8 7.2-16 16-16h24c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48h-24c-8.8 0-16-7.2-16-16V240zm32 112h8c8.8 0 16-7.2 16-16v-64c0-8.8-7.2-16-16-16h-8v96zm96-128h48c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v32h32c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v48c0 8.8-7.2 16-16 16s-16-7.2-16-16V240c0-8.8 7.2-16 16-16z"/></svg>
          </div>
        </a>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="CHIPS Alliance Caliptra Open Source I3C core" class="md-nav__button md-logo" aria-label="CHIPS Alliance Caliptra Open Source I3C core" data-md-component="logo">
      <img src="_static/white.svg" alt="logo">
    </a>
    CHIPS Alliance Caliptra Open Source I3C core
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        <span class="md-ellipsis">Introduction</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="overview.html" class="md-nav__link">
        <span class="md-ellipsis">I3C core overview</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="phy.html" class="md-nav__link">
        <span class="md-ellipsis">Physical Layer</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="dv.html" class="md-nav__link">
        <span class="md-ellipsis">Design verification</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="ext_cap.html" class="md-nav__link">
        <span class="md-ellipsis">Specification for I3C Vendor-<wbr>Specific Extended Capabilities</span>
      </a>
    </li>
  

    
      
      
      

  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span class="md-ellipsis">Recovery flow</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span class="md-ellipsis">Recovery flow</span>
      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recovery-handler" class="md-nav__link">
    <span class="md-ellipsis">Recovery handler</span>
  </a>
  
    <nav class="md-nav" aria-label="Recovery handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#normal-operation" class="md-nav__link">
    <span class="md-ellipsis">Normal operation</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recovery-operation" class="md-nav__link">
    <span class="md-ellipsis">Recovery operation</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#csr-access-via-i3c" class="md-nav__link">
    <span class="md-ellipsis">CSR access via I3C</span>
  </a>
  
    <nav class="md-nav" aria-label="CSR access via I3C">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#csr-write" class="md-nav__link">
    <span class="md-ellipsis">CSR write</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csr-read" class="md-nav__link">
    <span class="md-ellipsis">CSR read</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recovery-handler-operation" class="md-nav__link">
    <span class="md-ellipsis">Recovery handler operation</span>
  </a>
  
    <nav class="md-nav" aria-label="Recovery handler operation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#id4" class="md-nav__link">
    <span class="md-ellipsis">CSR write</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id5" class="md-nav__link">
    <span class="md-ellipsis">CSR read</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="axi_id_filtering.html" class="md-nav__link">
        <span class="md-ellipsis">AXI Transaction ID Filtering</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="axi_recovery_flow.html" class="md-nav__link">
        <span class="md-ellipsis">AXI driven Caliptra recovery flow</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="registers.html" class="md-nav__link">
        <span class="md-ellipsis">Register descriptions</span>
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


<h1 id="recovery-flow">Recovery flow<a class="headerlink" href="#recovery-flow" title="Link to this heading">¶</a></h1>
<p>The recovery flow is implemented according to the Open Compute Secure Firmware Recovery standard v1.1-rc5.
The recovery mode is handled through the virtual I3C target implemented by the core.
In the Recovery Mode the Recovery Initiator Device (e.g. BMC) is primarily responsible for streaming the Firmware Recovery Image to the I3C Core.
In order to facilitate this process, the I3C Core implements CSRs as specified in the <a class="reference internal" href="ext_cap.html#secure-firmware-recovery-interface-0xc0"><span class="std std-ref">Secure Firmware Recovery Interface</span></a>.
The firmware is responsible for implementing the recovery flow and transferring firmware data to the program memory.</p>
<p>The recovery flow adheres to the following steps:</p>
<ol class="arabic simple">
<li><p>Upon reset, the hardware sets the FIFO size and region type in the <code class="docutils literal notranslate"><span class="pre">INDIRECT_FIFO_STATUS</span></code> CSR</p></li>
<li><p>The device’s firmware configures the I3C core and sets the appropriate bits in the <code class="docutils literal notranslate"><span class="pre">PROT_CAP</span></code> CSR to indicate its recovery capabilities
These must include the mandatory ones:</p>
<ul class="simple">
<li><p>bit 0 (<code class="docutils literal notranslate"><span class="pre">DEVICE_ID</span></code>)</p></li>
<li><p>bit 4 (<code class="docutils literal notranslate"><span class="pre">DEVICE_STATUS</span></code>)</p></li>
<li><p>bit 6 (<code class="docutils literal notranslate"><span class="pre">Local</span> <span class="pre">C-image</span> <span class="pre">support</span></code>) or bit 7 (<code class="docutils literal notranslate"><span class="pre">Push</span> <span class="pre">C-image</span> <span class="pre">support</span></code>)</p></li>
<li><p>bit 5 (<code class="docutils literal notranslate"><span class="pre">INDIRECT_CTRL</span></code>), only if bit 7 is set</p></li>
</ul>
</li>
<li><p>Upon request for recovery mode entry, the firmware writes <code class="docutils literal notranslate"><span class="pre">0x3</span></code> (Recovery mode) to <code class="docutils literal notranslate"><span class="pre">DEVICE_STATUS</span></code></p></li>
<li><p>The Recovery Initiator writes to <code class="docutils literal notranslate"><span class="pre">INDIRECT_FIFO_CTRL</span></code> to inform the Recovery handler about the image size</p>
<ul class="simple">
<li><p>Component Memory Space (<code class="docutils literal notranslate"><span class="pre">CMS</span></code>) field is set to <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
</ul>
</li>
<li><p>The Recovery Initiator writes a data chunk to the receive FIFO via the <code class="docutils literal notranslate"><span class="pre">INDIRECT_FIFO_DATA</span></code> CSR.
The I3C core responds with a NACK when the FIFO is full.</p></li>
<li><p>The Recovery Handler updates FIFO pointers (Read Index and Write Index) presented in the <code class="docutils literal notranslate"><span class="pre">INDIRECT_FIFO_STATUS</span></code> CSR</p></li>
<li><p>The device’s firmware reacts to a signal that a data chunk has been written to the FIFO by polling the <code class="docutils literal notranslate"><span class="pre">INDIRECT_FIFO_STATUS</span></code> CSR</p></li>
<li><p>The device’s firmware reads the data chunk from the FIFO and stores it in an appropriate location in the memory</p></li>
<li><p>Steps 5 to 8 are repeated until the Recovery handler detects that the whole firmware image has been transmitted</p></li>
<li><p>The device’s firmware polls the <code class="docutils literal notranslate"><span class="pre">RECOVERY_CONTROL</span></code> register until it receives the “Activate image” command from the Recovery Initiator</p></li>
<li><p>The device’s firmware updates the <code class="docutils literal notranslate"><span class="pre">RECOVERY_STATUS</span></code> CSR to indicate that the uploaded firmware is being booted</p></li>
</ol>
<h2 id="recovery-handler">Recovery handler<a class="headerlink" href="#recovery-handler" title="Link to this heading">¶</a></h2>
<p>Since the OCP Secure Firmware Recovery standard describes a set of CSRs that are the interface between the device being updated and the Recovery Initiator, I3C transactions that access them must be handled in the logic instead of the firmware, which is the purpose of the Recovery Handler block.</p>
<p>When the recovery mode is active, the handler takes over the TTI interface of the controller.</p>
<figure class="align-default" id="id1">
<img alt="" src="_images/recovery_handler.png" />
<figcaption>
<p><span class="caption-number">Figure 6 </span><span class="caption-text"><span class="caption-text">
Recovery handler</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></figcaption>
</figure>
<p>The architecture of the Recovery Handler module is shown in the block diagram below:</p>
<figure class="align-default" id="recovery-handler-bd">
<img alt="" src="_images/recovery_handler_bd.png" />
<figcaption>
<p><span class="caption-number">Figure 7 </span><span class="caption-text"><span class="caption-text">
Recovery handler architecture</span><a class="headerlink" href="#recovery-handler-bd" title="Permalink to this image">¶</a></figcaption>
</figure>
<p>The module’s backend is connected directly to the controller’s TTI interface.
There are several muxes on the RX and TX data paths which allow bypassing the module in normal operation mode and remove/inject data in recovery mode.
There are two <code class="docutils literal notranslate"><span class="pre">PEC</span></code> (Packet Error Code) blocks responsible for calculating CRC for RX and TX data paths.
The CRC algorithm operates on individual bytes and implements C(x) = x^8+x^2+x^1+1 polynomial (see MCTP I3C binding, section 5.3.1).
The frontend is connected to I3C core CSRs accessible by software.</p>
<h3 id="normal-operation">Normal operation<a class="headerlink" href="#normal-operation" title="Link to this heading">¶</a></h3>
<p>When the recovery mode is disabled  the core allows accessing only a subset of recovery mode CSRs over I3C on the virtual target address.
These are the registers marked as “available anytime” by the recovery interface specification.
An attempt to access other CSRs results in a NACK response.</p>
<h3 id="recovery-operation">Recovery operation<a class="headerlink" href="#recovery-operation" title="Link to this heading">¶</a></h3>
<p>When the recovery mode is enabled all recovery CSRs can be accessible via I3C bus.
Accesses to the registers must be performed via the virtual target address.</p>
<h2 id="csr-access-via-i3c">CSR access via I3C<a class="headerlink" href="#csr-access-via-i3c" title="Link to this heading">¶</a></h2>
<p>Recovery mode CSRs are accessible through the I3C bus. The following protocol is used to implement read/write operations:</p>
<h3 id="csr-write">CSR write<a class="headerlink" href="#csr-write" title="Link to this heading">¶</a></h3>
<figure class="align-default" id="id2">
<img alt="" src="_images/i3c_csr_wr.png" />
<figcaption>
<p><span class="caption-number">Figure 8 </span><span class="caption-text"><span class="caption-text">
CSR write</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></figcaption>
</figure>
<p>The Recovery Initiator sends a command byte, followed by 16-bit payload length LSB and MSB bytes using I3C private transfers.
The payload data immediately follows the length bytes.
Each transfer ends with an additional byte containing a Packet Error Code (PEC) checksum.</p>
<h3 id="csr-read">CSR read<a class="headerlink" href="#csr-read" title="Link to this heading">¶</a></h3>
<figure class="align-default" id="id3">
<img alt="" src="_images/i3c_csr_rd.png" />
<figcaption>
<p><span class="caption-number">Figure 9 </span><span class="caption-text"><span class="caption-text">
CSR read</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></figcaption>
</figure>
<p>For CSR read, the Recovery Initiator sends only the command byte and PEC checksum.
Next, it issues a repeated start and begins a private read transaction.
The device responds by sending data length LSB and MSB bytes, followed by the data and PEC.</p>
<h2 id="recovery-handler-operation">Recovery handler operation<a class="headerlink" href="#recovery-handler-operation" title="Link to this heading">¶</a></h2>
<p>The main job of the Recovery Handler is providing hardware means for an active controller to access CSRs relevant to the recovery operation.</p>
<h3 id="id4">CSR write<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
<p>When the Recovery Initiator tries to write to a CSR through I3C, it first sends the command byte followed by two length bytes which are received by the handler logic.
If the length is non-zero, the handler resets the <code class="docutils literal notranslate"><span class="pre">PEC</span></code> block and sets <code class="docutils literal notranslate"><span class="pre">R2MUX</span></code> to pass the remaining data to the TTI RX data queue.
<code class="docutils literal notranslate"><span class="pre">R2MUX</span></code> disconnects the queue just before the last byte, which is the PEC checksum.
Finally, the last byte is compared with the checksum computed by the <code class="docutils literal notranslate"><span class="pre">PEC</span></code> block.</p>
<p>If the checksum matches the command, the handling part of the handler logic reads data from the TTI RX data queue and updates relevant CSR fields.</p>
<p>If the checksum does not match, then the handler discards all the data in the queue.</p>
<p>In case of an <code class="docutils literal notranslate"><span class="pre">INDIRECT_FIFO_DATA</span></code> write command the handler does not process the data at all. Instead, it passes the data to the RX indirect FIFO queue to make it available to the software.
When the software reads data from the <code class="docutils literal notranslate"><span class="pre">INDIRECT_FIFO_DATA</span></code> CSR, the handler updates the queue pointer in the <code class="docutils literal notranslate"><span class="pre">INDIRECT_FIFO_STATUS</span></code> CSR.</p>
<h3 id="id5">CSR read<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<p>A CSR read begins similarly as write, by receiving the command byte.
Following that, the command handling part reads data from the CSR being read and passes it to the transmit part, which formats the response I3C packet.</p>
<p>The transmit logic injects the CSR length, resets the TX <code class="docutils literal notranslate"><span class="pre">PEC</span></code> module, sends the CSR content to the I3C core and finally injects the calculated PEC checksum.</p>


  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      2025-07-27
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="ext_cap.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Specification for I3C Vendor-Specific Extended Capabilities" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Specification for I3C Vendor-Specific Extended Capabilities
            </div>
          </div>
        </a>
      
      
        
        <a href="axi_id_filtering.html" class="md-footer__link md-footer__link--next" aria-label="Next: AXI Transaction ID Filtering" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              AXI Transaction ID Filtering
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        Copyright &#169; Antmicro, 2025.
        
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/antmicro" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/antmicro" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["toc.integrate"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="_static/sphinx_immaterial_theme.f9d9eeeb247ace16c.min.js?v=8ec58cb5"></script>
    
  </body>
</html>